var y=Object.defineProperty;var v=(r,t,e)=>t in r?y(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var d=(r,t,e)=>(v(r,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();function L(r){let t=0,e=0,n=0,s=0;document.getElementById(r.id+"-header")?document.getElementById(r.id+"-header").onpointerdown=i:r.onpointerdown=i;function i(a){a.preventDefault(),n=a.clientX,s=a.clientY,document.onpointerup=l,document.onpointermove=o}function o(a){a.preventDefault(),t=n-a.clientX,e=s-a.clientY,n=a.clientX,s=a.clientY,r.style.top=r.offsetTop-e+"px",r.style.left=r.offsetLeft-t+"px"}function l(){document.onpointerup=null,document.onpointermove=null}}var c=(r=>(r[r.RECTANGLE=0]="RECTANGLE",r[r.CIRCLE=1]="CIRCLE",r[r.TRIANGLE=2]="TRIANGLE",r[r.LINE=3]="LINE",r))(c||{});class b{constructor(){d(this,"settings");d(this,"onBackgroundColorUpdate",()=>{});this.settings={type:c.RECTANGLE,fillColor:"#ff0000",pathColor:"#000000",lineWidth:5,backgroundColor:"#eeeeee"},this.init()}init(){const t=document.getElementById("draw-panel-container"),e=document.createElement("div");e.classList.add("parameters-list");const n=document.createElement("label");n.textContent="Shape: ";const s=document.createElement("select");s.id="shape-select";const i=document.createElement("option");i.value=c.RECTANGLE.toString(),i.textContent="Rectangle",s.appendChild(i);const o=document.createElement("option");o.value=c.CIRCLE.toString(),o.textContent="Circle",s.appendChild(o);const l=document.createElement("option");l.value=c.TRIANGLE.toString(),l.textContent="Triangle",s.appendChild(l);const a=document.createElement("option");a.value=c.LINE.toString(),a.textContent="Line",s.appendChild(a),e.appendChild(n),e.appendChild(s);const h=document.createElement("label");h.textContent="Line Width: ";const p=document.createElement("input");p.type="number",p.min="0",p.value=this.settings.lineWidth.toString(),e.appendChild(h),e.appendChild(p);const m=document.createElement("label");m.textContent="Fill Color: ";const f=document.createElement("input");f.type="color",f.value=this.settings.fillColor.toString(),e.appendChild(m),e.appendChild(f);const C=document.createElement("label");C.textContent="Path Color: ";const x=document.createElement("input");x.type="color",x.value=this.settings.pathColor.toString(),e.appendChild(C),e.appendChild(x),t.appendChild(e);const w=document.createElement("label");w.textContent="Background Color: ";const E=document.createElement("input");E.type="color",E.value=this.settings.backgroundColor.toString(),e.appendChild(w),e.appendChild(E),t.appendChild(e),s.addEventListener("change",u=>{const g=Number(u.target.value);this.settings.type=g}),p.addEventListener("input",u=>{const g=Number(u.target.value);this.settings.lineWidth=g}),f.addEventListener("input",u=>{const g=u.target.value;this.settings.fillColor=g}),x.addEventListener("input",u=>{const g=u.target.value;this.settings.pathColor=g}),E.addEventListener("input",u=>{const g=u.target.value;this.settings.backgroundColor=g,this.onBackgroundColorUpdate()})}}class I{constructor(t,e){d(this,"context");d(this,"canvas");this.context=t,this.canvas=e}clear(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}redraw(t){this.clear(),t.forEach(e=>{this.draw(e)})}drawImage(t,e,n){this.context.drawImage(t,e,n)}draw(t){switch(this.context.fillStyle=t.fillColor,this.context.strokeStyle=t.pathColor,this.context.lineWidth=t.lineWidth,t.type){case c.RECTANGLE:this.drawRect(t);break;case c.CIRCLE:this.drawCircle(t);break;case c.LINE:this.drawLine(t);break;case c.TRIANGLE:this.drawTriangle(t);break}}drawRect(t){const e=Math.abs(t.x2-t.x1),n=Math.abs(t.y2-t.y1),s=t.x1<=t.x2?t.x1:t.x2,i=t.y1<=t.y2?t.y1:t.y2;this.context.fillRect(s,i,e,n),t.lineWidth>0&&this.context.strokeRect(s,i,e,n)}drawCircle(t){const e=t.x1-t.x2,n=t.y1-t.y2,s=Math.sqrt(e*e+n*n)/2,i=t.x2+e/2,o=t.y2+n/2;this.context.beginPath(),this.context.arc(i,o,s,0,2*Math.PI,!1),this.context.fill(),t.lineWidth>0&&this.context.stroke()}drawTriangle(t){const e=(t.x1+t.x2)/2,n=t.y1;this.context.beginPath(),this.context.moveTo(e,n),this.context.lineTo(t.x1,t.y2),this.context.lineTo(t.x2,t.y2),this.context.closePath(),this.context.fillStyle=t.fillColor,this.context.fill(),t.lineWidth>0&&(this.context.strokeStyle=t.pathColor,this.context.lineWidth=t.lineWidth,this.context.stroke())}drawLine(t){this.context.beginPath(),this.context.lineWidth=t.lineWidth,this.context.moveTo(t.x2,t.y2),this.context.lineTo(t.x1||t.x2,t.y1||t.y2),this.context.stroke()}}function P(r){return typeof r!="string"?!1:!!(/^rgb\(\s*\d+\s*,\s*\d+\s*,\s*\d+\s*\)$/.test(r)||/^rgba\(\s*\d+\s*,\s*\d+\s*,\s*\d+\s*,\s*[\d.]+\s*\)$/.test(r)||/^#[0-9A-Fa-f]{6}$/.test(r))}class R{constructor(t,e){d(this,"objects");d(this,"selectedObject");d(this,"renderer");d(this,"parametersList");this.objects=t,this.renderer=e}setObjects(t){this.objects=t}handle(t){t.preventDefault();const{offsetX:e,offsetY:n}=t;this.selectedObject=this.getTopmostObject(e,n),this.selectedObject&&this.showProperties()}closeAllPopups(){document.querySelectorAll(".popup").forEach(t=>document.body.removeChild(t))}showProperties(){const t=c[this.selectedObject.type];this.closeAllPopups();const e=document.getElementById("panel-title");e.innerText=`${t}`,this.parametersList=document.getElementById("parameters-list"),this.parametersList.innerHTML="",["x1","y1","x2","y2","lineWidth","pathColor","fillColor"].forEach(s=>{this.addProperty(s)});const n=document.createElement("button");n.innerText="Delete",n.addEventListener("click",()=>{const s=this.objects.indexOf(this.selectedObject);s>-1&&(this.objects.splice(s,1),this.renderer.redraw(this.objects),this.closeAllPopups(),this.parametersList.innerHTML="",e.innerText="OBJECT")}),this.parametersList.appendChild(n)}addProperty(t){if(t!=="type"){const e=document.createElement("div");e.className="parameter";const n=document.createElement("span");switch(n.className="parameter-name",n.innerText=t.charAt(0).toUpperCase()+t.substring(1).toLowerCase(),n.innerText){case"Fillcolor":n.innerText="Fill Color";break;case"Pathcolor":n.innerText="Path Color";break;case"Linewidth":n.innerText="Line Width";break}const s=document.createElement("input");let i="string";typeof this.selectedObject[t]=="number"&&(i="number"),P(this.selectedObject[t])&&(i="color"),s.type=i,s.min="0",s.className="parameter-value",s.value=this.selectedObject[t].toString(),s.addEventListener("input",()=>{this.selectedObject[t]=s.type==="number"?Number(s.value):s.value,this.renderer.redraw(this.objects)}),e.appendChild(n),e.appendChild(s),this.parametersList.appendChild(e)}}getTopmostObject(t,e){for(let n=this.objects.length-1;n>=0;n--){const s=this.objects[n];if(n!==0&&this.isPointInsideObject(t,e,s))return s}return null}isPointInsideObject(t,e,n){switch(n.type){case c.RECTANGLE:return this.isPointInsideRectangle(t,e,n);case c.CIRCLE:return this.isPointInsideCircle(t,e,n);case c.TRIANGLE:return this.isPointInsideTriangle(t,e,n);case c.LINE:return this.isPointInsideLine(t,e,n);default:return!1}}isPointInsideRectangle(t,e,n){const{x1:s,y1:i,x2:o,y2:l}=n;return t>=s&&t<=o&&e>=i&&e<=l}isPointInsideCircle(t,e,n){const s=n.x1-n.x2,i=n.y1-n.y2,o=Math.sqrt(s*s+i*i)/2,l=n.x2+s/2,a=n.y2+i/2;return Math.sqrt(Math.pow(t-l,2)+Math.pow(e-a,2))<=o}area(t,e,n,s,i,o){return Math.abs((t*(s-o)+n*(o-e)+i*(e-s))/2)}isPointInsideTriangle(t,e,n){const s=n.x1,i=n.y2,o=(n.x1+n.x2)/2,l=n.y1,a=n.x2,h=n.y2;let p=this.area(s,i,o,l,a,h),m=this.area(t,e,o,l,a,h),f=this.area(s,i,t,e,a,h),C=this.area(s,i,o,l,t,e);return p==m+f+C}isPointInsideLine(t,e,n){const{x1:s,y1:i,x2:o,y2:l}=n,a=Math.sqrt(Math.pow(t-s,2)+Math.pow(e-i,2)),h=Math.sqrt(Math.pow(t-o,2)+Math.pow(e-l,2)),p=Math.sqrt(Math.pow(o-s,2)+Math.pow(l-i,2)),m=.1;return a+h>=p-m&&a+h<=p+m}}class T{constructor(t){d(this,"canvas");d(this,"renderer");d(this,"settingsPanel");d(this,"propertiesPanel");d(this,"objects");d(this,"drawingObject");this.objects=[],this.canvas=document.getElementById(t),this.settingsPanel=new b,this.renderer=new I(this.canvas.getContext("2d"),this.canvas),this.propertiesPanel=new R(this.objects,this.renderer),this.settingsPanel.onBackgroundColorUpdate=()=>{!this.objects[0]||this.objects[0].y2!==this.canvas.height||this.objects[0].x2!==this.canvas.width||(this.objects[0].fillColor=this.settingsPanel.settings.backgroundColor,this.renderer.redraw(this.objects))},this.canvas.addEventListener("pointerdown",this.startDrawing.bind(this)),this.canvas.addEventListener("pointerup",this.stopDrawing.bind(this)),this.canvas.addEventListener("pointermove",this.onDrawing.bind(this)),this.canvas.addEventListener("contextmenu",this.propertiesPanel.handle.bind(this.propertiesPanel)),this.objects.unshift({type:c.RECTANGLE,fillColor:this.settingsPanel.settings.backgroundColor,pathColor:"#000000",x1:0,lineWidth:0,y2:this.canvas.height,x2:this.canvas.width,y1:0}),this.renderer.redraw(this.objects),document.getElementById("clear").addEventListener("click",()=>{this.objects=[],this.renderer.redraw(this.objects)})}startDrawing(t){if(t.preventDefault(),t.button!==0)return;const{offsetX:e,offsetY:n}=t;this.drawingObject={type:this.settingsPanel.settings.type,x1:e,y1:n,fillColor:this.settingsPanel.settings.fillColor,pathColor:this.settingsPanel.settings.pathColor,lineWidth:this.settingsPanel.settings.lineWidth}}stopDrawing(t){if(t.preventDefault(),t.button!==0)return;const{offsetX:e,offsetY:n}=t;this.drawingObject={x2:e,y2:n,...this.drawingObject},this.objects.push(this.drawingObject),this.drawingObject=null,this.renderer.redraw(this.objects)}onDrawing(t){if(t.preventDefault(),t.button!==-1)return;const{offsetX:e,offsetY:n}=t;this.renderer.redraw(this.objects);const s={x2:e,y2:n,...this.drawingObject};this.renderer.draw(s)}saveImage(){const t=this.canvas.toDataURL("image/png"),e=document.createElement("a");e.href=t,e.download="image.png",e.click()}saveData(){const t=JSON.stringify(this.objects),e="data.json",n=new Blob([t],{type:"application/json"});if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(n,e);else{const s=URL.createObjectURL(n),i=document.createElement("a");i.href=s,i.download=e,i.click(),setTimeout(()=>{URL.revokeObjectURL(s)},0)}}loadData(t){this.objects=JSON.parse(t),this.propertiesPanel.setObjects(this.objects),this.renderer.redraw(this.objects)}}window.addEventListener("load",O);function O(){N();const r=new T("canvas");document.getElementById("load").addEventListener("click",()=>{document.getElementById("file-input").click()}),document.getElementById("save").addEventListener("click",()=>{r.saveData()}),document.getElementById("export").addEventListener("click",()=>{r.saveImage()}),document.getElementById("file-input").addEventListener("change",t=>{const n=t.target.files[0],s=new FileReader;s.onload=i=>{const o=i.target.result;r.loadData(o)},s.readAsText(n)})}function N(){L(document.getElementById("panel-container")),L(document.getElementById("draw-panel-container")),document.getElementById("draw-panel-container").style.top="547px"}
